<!-- 
====================================
세계관 입력 컴포넌트 템플릿
====================================
사용자가 게임 세계관을 입력하고 AI 생성을 시작하는 컴포넌트입니다.

주요 구성:
1. 세계관 입력 폼 - 테마, 설정, 추가 정보 입력
2. 예시 아이디어 섹션 - 클릭으로 빠른 입력 가능
3. 로딩 상태 처리 - 생성 중 UI 피드백
4. 키보드 단축키 지원 - Ctrl+Enter로 빠른 제출
-->

<div class="world-input-container">
  <!-- ==================== 서버 상태 표시 ==================== -->
  <div class="server-status-bar" [class.connected]="serverConnected" [class.disconnected]="!serverConnected">
    <span class="status-indicator">{{ serverConnected ? '🟢' : '🔴' }}</span>
    <span class="status-text">
      {{ serverConnected ? '서버 연결됨 - 고급 AI 기능 사용 가능' : '서버 연결 안됨 - 기본 Mock 기능만 사용 가능' }}
    </span>
  </div>

  <!-- ==================== 세계관 생성 메인 폼 ==================== -->
  <form (ngSubmit)="onSubmit()" class="world-form">
    <!-- ==================== 기본 세계관 설명 ==================== -->
    <div class="input-group">
      <label for="worldInput" class="input-label">
        <mat-icon>public</mat-icon>
        세계관 기본 컨셉
      </label>
      
      <textarea
        id="worldInput"
        [(ngModel)]="worldInput"
        name="worldInput"
        class="fantasy-input world-textarea"
        [placeholder]="placeholder"
        (keydown)="onKeyPress($event)"
        [disabled]="isLoading"
        rows="3"
        matTooltip="게임 세계관의 핵심 아이디어를 간단히 설명해주세요">
      </textarea>
      
      <div class="input-hint">
        💡 세계관의 핵심 컨셉을 한두 문장으로 요약해주세요
      </div>
    </div>

    <!-- ==================== 세부 설정 입력 ==================== -->
    <div class="details-section">
      <h4 class="section-title">
        <mat-icon>tune</mat-icon>
        세부 설정
      </h4>
      
      <div class="details-grid">
        <!-- 테마 입력 -->
        <div class="input-group">
          <label for="theme" class="input-label">
            🎨 융합 테마 (장르)
          </label>
          <input
            id="theme"
            [(ngModel)]="theme"
            name="theme"
            type="text"
            class="fantasy-input"
            placeholder="예: fantasy, cyberpunk, space-opera"
            [disabled]="isLoading"
            matTooltip="장르나 분위기를 나타내는 키워드 (예: fantasy, cyberpunk, steampunk, horror)">
          
          <div class="example-chips">
            <span *ngFor="let example of themeExamples.slice(0, 5)" 
                  class="chip" 
                  (click)="theme = example"
                  [class.selected]="theme === example">
              {{ example }}
            </span>
          </div>
        </div>

        <!-- 배경 설정 입력 -->
        <div class="input-group">
          <label for="setting" class="input-label">
            🏛️ 배경 설정
          </label>
          <input
            id="setting"
            [(ngModel)]="setting"
            name="setting"
            type="text"
            class="fantasy-input"
            placeholder="예: 미래 도시, 중세 왕국, 우주 정거장"
            [disabled]="isLoading"
            matTooltip="게임이 펼쳐지는 구체적인 장소나 환경">
          
          <div class="example-chips">
            <span *ngFor="let example of settingExamples.slice(0, 4)" 
                  class="chip" 
                  (click)="setting = example"
                  [class.selected]="setting === example">
              {{ example }}
            </span>
          </div>
        </div>
      </div>

      <!-- 추가 정보 입력 -->
      <div class="input-group">
        <label for="additionalInfo" class="input-label">
          ⚡ 추가 정보 (갈등, 특징)
        </label>
        <textarea
          id="additionalInfo"
          [(ngModel)]="additionalInfo"
          name="additionalInfo"
          class="fantasy-input"
          placeholder="예: 종족 간 갈등, 마법과 기술의 대립, 자원 부족"
          [disabled]="isLoading"
          rows="2"
          matTooltip="세계관의 주요 갈등, 독특한 특징, 플레이어가 직면할 도전 등">
        </textarea>
        
        <div class="input-hint">
          💡 주요 갈등, 독특한 요소, 게임플레이에 영향을 줄 특징들
        </div>
      </div>
    </div>

    <!-- ==================== 생성 옵션 설정 ==================== -->
    <div class="generation-options" *ngIf="serverConnected">
      <h4 class="options-title">🎛️ 생성 옵션</h4>
      
      <div class="options-grid">
        <!-- 웹 검색 옵션 -->
        <div class="option-item">
          <mat-slide-toggle 
            [(ngModel)]="useWebSearch" 
            name="useWebSearch"
            color="primary"
            matTooltip="웹 검색을 사용하면 더 풍부한 정보를 바탕으로 세계관을 생성하지만, 때로는 일관성이 떨어질 수 있습니다.">
            <mat-icon>search</mat-icon>
            웹 검색 사용
          </mat-slide-toggle>
          <span class="option-description">
            {{ useWebSearch ? '인터넷 정보를 참고하여 더 풍부한 세계관 생성' : '프롬프트만으로 일관성 있는 세계관 생성' }}
          </span>
        </div>

        <!-- NPC 생성 옵션 -->
        <div class="option-item">
          <mat-slide-toggle 
            [(ngModel)]="includeNPCs" 
            name="includeNPCs"
            color="primary"
            matTooltip="NPC를 포함하여 세계관을 더욱 생동감 있게 만들 수 있습니다.">
            <mat-icon>people</mat-icon>
            NPC 생성 포함
          </mat-slide-toggle>
          <span class="option-description">
            {{ includeNPCs ? 'NPC가 포함된 세계관을 생성합니다' : 'NPC 없이 세계관만 생성됩니다' }}
          </span>
        </div>
      </div>
    </div>
    
    <!-- 버튼 그룹 -->
    <div class="button-group">
      <!-- 통합 생성 버튼 (서버 연결시만 활성화) -->
      <button 
        type="button"
        (click)="onFullSubmit()" 
        class="fantasy-button full-submit-button"
        [disabled]="!isFormValid() || isLoading || !serverConnected"
        [title]="!serverConnected ? '서버 연결이 필요합니다' : !isFormValid() ? '모든 필수 필드를 입력해주세요' : '세계관 + NPC + 이미지를 한 번에 생성합니다'">
        <!-- 일반 상태 -->
        <span *ngIf="!isLoading" class="button-content">
          ✨ 통합 생성 (AI)
        </span>
        <!-- 로딩 상태 -->
        <span *ngIf="isLoading" class="loading-content">
          <div class="loading-spinner"></div>
          AI 생성 중...
        </span>
      </button>
    </div>

    <!-- 폼 유효성 안내 -->
    <div class="validation-hint" *ngIf="!isFormValid() && (worldInput || theme || setting)">
      <mat-icon>info</mat-icon>
      <span>세계관 컨셉, 테마, 배경 설정은 필수 입력 항목입니다.</span>
    </div>
  </form>

  <!-- ==================== 예시 아이디어 섹션 ==================== -->
  <!-- 입력이 비어있을 때만 표시되는 영감을 주는 예시들 -->
  <div class="examples" *ngIf="!worldInput.trim()">
    <h4>💡 빠른 시작 예시:</h4>
    <div class="example-list">
      <!-- 사이버펑크 예시 -->
      <div class="example-item" (click)="setExampleIdea('cyberpunk')">
        <div class="example-header">
          <span class="example-theme">🌃 사이버펑크</span>
        </div>
        <div class="example-description">
          "해커들이 가상 네트워크를 통해 현실을 조작하는 미래 사회"
        </div>
      </div>
      
      <!-- 스페이스 오페라 예시 -->
      <div class="example-item" (click)="setExampleIdea('space')">
        <div class="example-header">
          <span class="example-theme">🚀 스페이스 오페라</span>
        </div>
        <div class="example-description">
          "서로 다른 외계 종족들이 생존을 위해 협력해야 하는 우주 정거장"
        </div>
      </div>
      
      <!-- 포스트 아포칼립스 예시 -->
      <div class="example-item" (click)="setExampleIdea('nature')">
        <div class="example-header">
          <span class="example-theme">🌿 포스트 아포칼립스</span>
        </div>
        <div class="example-description">
          "자연이 진화하여 문명을 되찾은 포스트 아포칼립스 세계"
        </div>
      </div>
    </div>
    
    <div class="example-hint">
      💡 예시를 클릭하면 모든 필드가 자동으로 채워집니다
    </div>
  </div>
</div>
